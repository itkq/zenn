---
title: "Slack ã® RTM bot ãŒå®Ÿè³ªæ©Ÿèƒ½ã—ãªããªã‚‹ã“ã¨ã«åˆã‚ã›ã¦ Socket mode ã«ç§»è¡Œã™ã‚‹"
emoji: "ğŸ˜‡"
type: "tech"
topics: ["slack"]
published: false
---

# TL;DR
- 2021-02-24 ä»¥é™ Slack method `channels.*`, `groups.*`, `im.*`, `mpim.*` ãŒåˆ©ç”¨ã§ããªããªã‚Šã€ä»£æ›¿ã¨ã—ã¦ `conversations.*` method ã‚’åˆ©ç”¨ã™ã‚‹å¿…è¦ãŒã‚ã‚‹
- Classic app ã® RTM API ã¯å¼•ãç¶šãæ©Ÿèƒ½ã™ã‚‹ãŒã€`conversations.*` method ã«å¿…è¦ãª bot ã® scope ã§ã‚ã‚‹ `channels.manage` ã¯ Update scope ã—ãªã„ã¨ä»˜ä¸ã§ãã‚‹ã‚ˆã†ã«ãªã‚‰ãªã„
- Update scope ã—ãŸå ´åˆã€bot ã¯ RTM API ã‚’åˆ©ç”¨ä¸èƒ½ã«ãªã‚‹ãŸã‚ã€æ©Ÿèƒ½ã‚’ç¶­æŒã™ã‚‹ãŸã‚ã«ã¯ Socket mode + Events API ã«ç§»è¡Œã™ã‚‹ã®ãŒç¶ºéº—ã«ã„ããã†


# Conversations API
https://api.slack.com/changelog/2020-01-deprecating-antecedents-to-the-conversations-api ã®é€šã‚Šã€ã“ã‚Œã¾ã§ Public channel, Private channel, DM, Group DM ã§ãã‚Œãã‚Œåˆ†ã‹ã‚Œã¦ã„ãŸ API ãŒä¸€ã¤ã® Conversations API ã¨ã—ã¦çµ±åˆã•ã‚Œã¾ã™ã€‚Deprecating å®£è¨€ã•ã‚Œã¦ã„ã‚‹ method ã¯ã€2020-06-10 ä»¥é™ã«ä½œã‚‰ã‚ŒãŸ app ã§ã¯ã™ã§ã«åˆ©ç”¨ä¸èƒ½ã§ã€ãã‚Œä»¥å¤–ã® app ã§ã‚‚ 2021-02-24 ã«åˆ©ç”¨ä¸èƒ½ã«ãªã‚‹ã‚ˆã†ã§ã™ã€‚

## RTM bot ã®ç§»è¡Œ
ä»®ã«ã€ã‚ã‚‹ RTM bot (classic) ã‚’é£¼ã£ã¦ã„ã‚‹ã“ã¨ã«ã—ã¾ã—ã‚‡ã†ã€‚ã“ã® bot ã¯ç‰¹å®šã®ç™ºè¨€ã«åå¿œã—ã¦ Public channel ã‚’ä½œã‚‹æ©Ÿèƒ½ãŒã‚ã‚Šã€[`channels.create`](https://api.slack.com/methods/channels.create) method ã‚’ä½¿ã£ã¦å®Ÿè£…ã•ã‚Œã¦ã„ã¾ã™ã€‚2021-02-24 ä»¥é™ã€ã“ã®æ©Ÿèƒ½ãŒåˆ©ç”¨ã§ããªããªã‚‹ã¨å›°ã‚‹ã®ã§ã€[`conversations.create`](https://api.slack.com/methods/conversations.create) method ã«ç§»è¡Œã™ã‚‹ã“ã¨ã«ã—ã¾ã—ãŸã€‚

`conversations.create` method ã‚’ä½¿ã£ã¦ bot ãŒ Public channel ã‚’ä½œã‚‹ãŸã‚ã«ã¯ã€[`channels.manage`](https://api.slack.com/scopes/channels:manage) scope ãŒå¿…è¦ã§ã™ã€‚Supported token types ã«ã¯ classic bot ã¨ bot ã®ä¸¡æ–¹ãŒæŒ™ã’ã‚‰ã‚Œã¦ã„ã¾ã™ã€‚ã—ã‹ã—ã€classic bot ã§ã¯ [Update scope](https://api.slack.com/authentication/migration#update_ui) ã—ãªã„ã¨ãã‚‚ãã‚‚ `channels.manage` scope ã‚’ä»˜ä¸ã™ã‚‹ã“ã¨ãŒã§ãã¾ã›ã‚“ã€‚

ãã“ã§ Update scope ã‚’æ¤œè¨ã—ã¦ã¿ã¾ã™ãŒã€Update scope ã—ã¦å¾—ã‚‰ã‚ŒãŸãƒˆãƒ¼ã‚¯ãƒ³ã§ã¯ã€RTM API ã‚’åˆ©ç”¨ã§ããªããªã‚Šã¾ã™ã€‚https://api.slack.com/authentication/migration#select_user ã§ã¯

> New Slack apps may not access RTM.

ã¨æ›¸ã‹ã‚Œã¦ã„ã¾ã™ãŒã€Slack classic app ã® Update scope UI ã§ã¯

> The RTM API is not accessible to updated Bot Tokens.

ã¨ãƒãƒƒã‚­ãƒªæ›¸ã‹ã‚Œã¦ã„ã¾ã—ãŸã€‚ä»¥ä¸Šã‹ã‚‰ã€RTM API ã‚’åˆ©ç”¨ã™ã‚‹ bot ãŒ Public channel ã‚’ä½œæˆã§ãã‚‹ã¨ã„ã†æŒ™å‹•ã‚’ç¶­æŒã™ã‚‹ãŸã‚ã«ã¯ã€çµå±€ RTM API ã‚’æ¨ã¦ã‚‹ã—ã‹ãªã•ãã†ã§ã—ãŸã€‚

# Socket mode + Events API
RTM API ã¯ Slack ãŒ ["outmoded way of connecting your application to Slack"](https://api.slack.com/start/planning/choosing#choosing-the-right-apis__real-time-messagnig) ã¨è¡¨ç¾ã—ã¦ãŠã‚Šã€ç§»è¡Œå…ˆã¨ã—ã¦ [Socket mode](https://api.slack.com/apis/connections/socket) ã¨ [Events API](https://api.slack.com/apis/connections/events-api) ã‚’æä¾›ã—ã¦ã„ã¾ã™ã€‚ã“ã® 2 ã¤ã‚’åˆ©ç”¨ã™ã‚‹ã“ã¨ã§ã€RTM API ã§è¡Œãˆã¦ã„ãŸã€WebSocket connection ã¨ Event subscription ã‚’äº«å—ã§ãã¾ã™ã€‚

## RTM bot ã®ç§»è¡Œ (again)
æ–°ãŸã« classic ã§ãªã„ Slack app ã‚’ä½œæˆã™ã‚‹ã“ã¨ã«ã—ã¾ã™ã€‚Socket mode ã¨ Events API ã®æœ‰åŠ¹åŒ–ã¯ãƒ‰ã‚­ãƒ¥ãƒ¡ãƒ³ãƒˆé€šã‚Šã«ã‚„ã‚‹ã ã‘ã§ã™ã€‚`conversations.create` scope ã‚’ä¸ãˆã¦ workspace ã«ã‚¤ãƒ³ã‚¹ãƒˆãƒ¼ãƒ«ã—ã€bot token ã‚’å¾—ã¾ã™ã€‚ã¾ãŸã€Socket mode ã«å¿…è¦ãª App-level token ã‚‚å¾—ã¾ã™ã€‚

å…ˆã«ä¾‹ã§æŒ™ã’ãŸ bot ã¯ Go ã§æ›¸ã‹ã‚Œã¦ã„ã¦ã€https://github.com/slack-go/slack ã‚’åˆ©ç”¨ã—ã¦ã„ã¾ã—ãŸã€‚ã“ã®ãƒ©ã‚¤ãƒ–ãƒ©ãƒªã¯ Socket mode å¯¾å¿œãŒã™ã§ã«æ¸ˆã‚“ã§ãŠã‚Šã€[é››å½¢ã¨ãªã‚‹ä¾‹](https://github.com/slack-go/slack/blob/master/examples/socketmode/socketmode.go) ã‚‚ã‚ã‚‹ã®ã§ã€ã“ã‚Œã‚’æŒã£ã¦ãã‚Œã° RTM ã‹ã‚‰ã®ç§»è¡Œã¯æ¯”è¼ƒçš„ç°¡å˜ã§ã—ãŸã€‚

# ç§»è¡Œã—ãªã„å¦¥å”æ¡ˆ
bot token ã§ã¯ãªã user token ã‚’ä½¿ã†å ´åˆã€`conversations.create` ã«å¿…è¦ãªã®ã¯ `channels.write` scope ã«ãªã‚Šã¾ã™ã€‚ã“ã® scope ã¯ Classic app ã§ä»˜ä¸å¯èƒ½ãªã®ã§ã€bot ã§ã¯ãªã user ãŒ Public channel ã‚’ä½œã‚‹ã“ã¨ã«å¦¥å”ã™ã‚Œã°ã€RTM API ã‚’æ¨ã¦ãšã«æ¸ˆã‚€ã§ã—ã‚‡ã†ã€‚
